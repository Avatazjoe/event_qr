<!-- users/dashboard.html -->
{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container mt-4"> <!-- Assuming .container class is for general layout -->
  <h1>Welcome back, {{ user.username }}!</h1>

  <div class="row mt-4">
    <!-- Recent Events -->
    <div class="col-md-6">
      <h3>Your Recent Events</h3>
      {% if user_events %}
        <ul class="list-group">
          {% for event in user_events %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ event.name }}</span>
              <small class="text-muted">{{ event.date }}</small>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No events attended yet.</p>
      {% endif %}
    </div>

    <!-- Purchase History -->
    <div class="col-md-6">
      <h3>Recent Purchase History (Last 5)</h3>
      {% if orders %} <!-- This 'orders' context variable comes from the dashboard view -->
        <ul class="list-group">
          {% for order in orders %} <!-- These are the 5 most recent orders from dashboard view -->
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span><a href="{% url 'marketplace:order_detail' order.id %}">Order #{{ order.id }} - {{ order.items.first.product.name|default:'N/A' }}{% if order.items.count > 1 %} et al.{% endif %}</a></span>
              <span>${{ order.get_total_cost }}</span>
            </li>
          {% empty %} <!-- Added this empty for the dashboard orders list -->
            <li class="list-group-item">No recent purchases found.</li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No purchases yet.</p> <!-- This will be shown if the 'orders' variable itself is None or empty, which is fine. -->
      {% endif %}
    </div>
  </div>

  <div class="mt-4">
    <h3>Quick Actions</h3>
    <div class="btn-group" role="group" aria-label="Quick Actions">
      <a href="{% url 'users:profile' %}" class="btn btn-info">View/Edit Profile</a> <!-- Ensure 'users:profile' is correct -->
      <a href="{% url 'marketplace:order_history' %}" class="btn btn-secondary">Full Order History</a>
      <a href="{% url 'event:crear_evento' %}" class="btn btn-success">Create Event</a> <!-- Assuming 'event:crear_evento' is the correct URL name -->
      <a href="{% url 'marketplace:create_product' %}" class="btn btn-warning">Create Product</a> <!-- Changed from # to actual URL -->
    </div>
  </div>
</div>
{% endblock %}
